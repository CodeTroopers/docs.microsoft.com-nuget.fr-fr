---
title: "Résolution des dépendances de package NuGet | Microsoft Docs"
author: kraigb
ms.author: kraigb
manager: ghogen
ms.date: 8/14/2017
ms.topic: article
ms.prod: nuget
ms.technology: 
ms.assetid: 1d530a72-3486-4a0d-b6fb-017524616f91
description: "Informations détaillées sur le processus par lequel les dépendances d’un package NuGet sont résolues , puis installées dans NuGet 2.x et NuGet 3.x+."
keywords: "Dépendances de package NuGet, gestion des versions NuGet, versions des dépendances, graphique des versions, résolution des versions, restauration transitive"
ms.reviewer:
- karann-msft
- unniravindranathan
ms.openlocfilehash: 44c69c07990fed72b439698d22021ebcbb2eed89
ms.sourcegitcommit: d0ba99bfe019b779b75731bafdca8a37e35ef0d9
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/14/2017
---
# <a name="how-nuget-resolves-package-dependencies"></a><span data-ttu-id="a5cad-104">Comment NuGet résout les dépendances de package</span><span class="sxs-lookup"><span data-stu-id="a5cad-104">How NuGet resolves package dependencies</span></span>

<span data-ttu-id="a5cad-105">Lorsqu’un package est installé ou réinstallé, y compris dans le cadre d’un processus de [restauration](../consume-packages/package-restore.md), NuGet installe également tous les packages supplémentaires dont dépend ce premier package.</span><span class="sxs-lookup"><span data-stu-id="a5cad-105">Any time a package is installed or reinstalled, which includes being installed as part of a [restore](../consume-packages/package-restore.md) process, NuGet also installs any additional packages on which that first package depends.</span></span>

<span data-ttu-id="a5cad-106">Ces dépendances immédiates peuvent également avoir leurs propres dépendances, et les dépendances peuvent ainsi continuer jusqu’à la profondeur souhaitée.</span><span class="sxs-lookup"><span data-stu-id="a5cad-106">Those immediate dependencies might then also have dependencies on their own, which can continue to an arbitrary depth.</span></span> <span data-ttu-id="a5cad-107">Cela génère ce que l’on appelle un *graphique de dépendance*, qui montre les relations entre les packages de tous les niveaux.</span><span class="sxs-lookup"><span data-stu-id="a5cad-107">This produces what's called a *dependency graph* that describes the relationships between packages are all levels.</span></span>

<span data-ttu-id="a5cad-108">Lorsque plusieurs packages partagent une même dépendance, le même ID de package peut apparaître plusieurs fois dans le graphique, potentiellement avec des restrictions de version différentes.</span><span class="sxs-lookup"><span data-stu-id="a5cad-108">When multiple packages have the same dependency, then the same package ID can appear in the graph multiple times, potentially with different version constraints.</span></span> <span data-ttu-id="a5cad-109">Néanmoins, une seule version d’un package donné peut être utilisée dans un projet. De fait, NuGet doit choisir quelle version utiliser.</span><span class="sxs-lookup"><span data-stu-id="a5cad-109">However, only one version of a given package can be used in a project, so NuGet must choose which version is be used.</span></span> <span data-ttu-id="a5cad-110">Le processus exact varie selon le format de référence de package utilisé.</span><span class="sxs-lookup"><span data-stu-id="a5cad-110">The exact process depends on the package reference format being used.</span></span>

<span data-ttu-id="a5cad-111">Dans cette rubrique :</span><span class="sxs-lookup"><span data-stu-id="a5cad-111">In this topic:</span></span>
- [<span data-ttu-id="a5cad-112">Résolution des dépendances avec PackageReference et project.json</span><span class="sxs-lookup"><span data-stu-id="a5cad-112">Dependency resolution with PackageReference and project.json</span></span>](#dependency-resolution-with-packagereference-and-projectjson)
- [<span data-ttu-id="a5cad-113">Résolution des dépendances avec packages.config</span><span class="sxs-lookup"><span data-stu-id="a5cad-113">Dependency resolution with packages.config</span></span>](#dependency-resolution-with-packagesconfig)
- <span data-ttu-id="a5cad-114">[Exclusion de références](#excluding-references), ce qui est nécessaire en cas de conflit entre une dépendance spécifiée dans un projet et un assembly généré par un autre projet.</span><span class="sxs-lookup"><span data-stu-id="a5cad-114">[Excluding references](#excluding-references), which is necessary when there's a conflict between a dependency specified in one project and an assembly that's produced by another.</span></span>
- [<span data-ttu-id="a5cad-115">Mises à jour des dépendances pendant l’installation du package</span><span class="sxs-lookup"><span data-stu-id="a5cad-115">Dependency updates during package install</span></span>](#dependency-updates-during-package-install)
- [<span data-ttu-id="a5cad-116">Résolution des erreurs de package incompatible</span><span class="sxs-lookup"><span data-stu-id="a5cad-116">Resolving incompatible package errors</span></span>](#resolving-incompatible-package-errors)

## <a name="dependency-resolution-with-packagereference-and-projectjson"></a><span data-ttu-id="a5cad-117">Résolution des dépendances avec PackageReference et project.json</span><span class="sxs-lookup"><span data-stu-id="a5cad-117">Dependency resolution with PackageReference and project.json</span></span>

<span data-ttu-id="a5cad-118">Lors de l’installation de packages dans des projets à l’aide des formats PackageReference ou `project.json`, NuGet ajoute des références à un graphique de package à deux dimensions dans le fichier approprié, et résout les conflits à l’avance.</span><span class="sxs-lookup"><span data-stu-id="a5cad-118">When installing packages into projects using the PackageReference or `project.json` formats, NuGet adds references to a flat package graph in the appropriate file and resolves conflicts ahead of time.</span></span> <span data-ttu-id="a5cad-119">Ce processus est appelé *restauration transitive*.</span><span class="sxs-lookup"><span data-stu-id="a5cad-119">This process is referred to as *transitive restore*.</span></span> <span data-ttu-id="a5cad-120">Les processus de réinstallation et de restauration des packages reviennent donc à télécharger les packages répertoriés dans le graphique, ce qui permet d’obtenir des builds plus prévisibles, plus rapidement.</span><span class="sxs-lookup"><span data-stu-id="a5cad-120">Reinstalling or restoring packages is then a process of downloading the packages listed in the graph, resulting in faster and more predictable builds.</span></span> <span data-ttu-id="a5cad-121">Vous pouvez également tirer parti des versions génériques (flottantes), telles que 2.8.\*, afin d’éviter les appels à `nuget update` (qui sont coûteux et sujets aux erreurs) sur les ordinateurs clients et les serveurs de builds.</span><span class="sxs-lookup"><span data-stu-id="a5cad-121">You can also take advantage of wildcard (floating) versions, such as 2.8.\*, avoiding expensive and error prone calls to `nuget update` on the client machines and build servers.</span></span>

<span data-ttu-id="a5cad-122">Lorsque le processus de restauration NuGet est exécuté avant une build, il résout d’abord les dépendances dans la mémoire, puis écrit le graphique résultant dans un fichier appelé `project.assets.json` situé dans le dossier `obj` d’un projet qui utilise PackageReference, ou dans un fichier nommé `project.lock.json` en même temps que `project.json`.</span><span class="sxs-lookup"><span data-stu-id="a5cad-122">When the NuGet restore process runs prior to a build, it resolves dependencies first in memory, then writes the resulting graph to a file called `project.assets.json` in the `obj` folder of a project using PackageReference, or in a file named `project.lock.json` alongside `project.json`.</span></span> <span data-ttu-id="a5cad-123">MSBuild lit alors ce fichier et le convertit en un ensemble de dossiers pouvant contenir des références, puis les ajoute à l’arborescence de projets en mémoire.</span><span class="sxs-lookup"><span data-stu-id="a5cad-123">MSBuild then reads this file and translates it into a set of folders where potential references can be found, and then adds them to the project tree in memory.</span></span>

<span data-ttu-id="a5cad-124">Le fichier de verrouillage est temporaire et ne doit pas être ajouté au contrôle de code source.</span><span class="sxs-lookup"><span data-stu-id="a5cad-124">The lock file is temporary and should not be added to source control.</span></span> <span data-ttu-id="a5cad-125">Ce fichier est répertorié par défaut dans `.gitignore` et `.tfignore`.</span><span class="sxs-lookup"><span data-stu-id="a5cad-125">It's listed by default in both `.gitignore` and `.tfignore`.</span></span> <span data-ttu-id="a5cad-126">Consultez [Packages et contrôle de code source](Packages-and-Source-Control.md).</span><span class="sxs-lookup"><span data-stu-id="a5cad-126">See [Packages and source control](Packages-and-Source-Control.md).</span></span>

### <a name="dependency-resolution-rules"></a><span data-ttu-id="a5cad-127">Règles de résolution des dépendances</span><span class="sxs-lookup"><span data-stu-id="a5cad-127">Dependency resolution rules</span></span>

<span data-ttu-id="a5cad-128">La restauration transitive applique quatre règles principales pour résoudre les dépendances : la plus ancienne version applicable, les versions flottantes, le package le plus proche et les dépendances cousines.</span><span class="sxs-lookup"><span data-stu-id="a5cad-128">Transitive restore applies four main rules to resolve dependencies: lowest applicable version, floating versions, nearest-wins, and cousin dependencies.</span></span>

<a name="lowest-applicable-version"></a>

#### <a name="lowest-applicable-version"></a><span data-ttu-id="a5cad-129">La plus ancienne version applicable</span><span class="sxs-lookup"><span data-stu-id="a5cad-129">Lowest applicable version</span></span>

<span data-ttu-id="a5cad-130">La règle de la version la plus ancienne applicable restaure la version la plus ancienne possible d’un package, comme défini par ses dépendances.</span><span class="sxs-lookup"><span data-stu-id="a5cad-130">The lowest applicable version rule restores the lowest possible version of a package as defined by its dependencies.</span></span> <span data-ttu-id="a5cad-131">Elle s’applique également aux dépendances de l’application et de la bibliothèque de classes, sauf si déclarée comme [flottante](#floating-versions).</span><span class="sxs-lookup"><span data-stu-id="a5cad-131">It also applies to dependencies on the application or the class library unless declared as [floating](#floating-versions).</span></span>

<span data-ttu-id="a5cad-132">Dans la figure suivante, par exemple, 1.0-beta est considéré comme une version plus ancienne que 1.0. De fait, NuGet choisit la version 1.0 :</span><span class="sxs-lookup"><span data-stu-id="a5cad-132">In the following figure, for example, 1.0-beta is considered lower than 1.0 so NuGet chooses the 1.0 version:</span></span>

![Choix de la plus ancienne version applicable](media/projectJson-dependency-1.png)

<span data-ttu-id="a5cad-134">Dans la figure suivante, la version 2.1 n’est pas disponible dans le flux. Toutefois, étant donné que la restriction de version est supérieure ou égale à 2.1, NuGet récupère la plus ancienne version suivante, dans ce cas 2.2 :</span><span class="sxs-lookup"><span data-stu-id="a5cad-134">In the next figure, version 2.1 is not available on the feed but because the version constraint is >= 2.1 NuGet picks the next lowest version it can find, in this case 2.2:</span></span>

![Choix de la plus ancienne version suivante disponible dans le flux](media/projectJson-dependency-2.png)

<span data-ttu-id="a5cad-136">Lorsqu’une application spécifie un numéro de version exact (tel que 1.2) qui n’est pas disponible dans le flux, NuGet échoue avec une erreur lorsque vous tentez d’installer ou de restaurer le package :</span><span class="sxs-lookup"><span data-stu-id="a5cad-136">When an application specifies an exact version number, such as 1.2, that is not available on the feed, NuGet fails with an error when attempting to install or restore the package:</span></span>

![NuGet génère une erreur lorsqu’une version de package exacte n’est pas disponible](media/projectJson-dependency-3.png)

<a name="floating-versions"></a>

#### <a name="floating-wildcard-versions"></a><span data-ttu-id="a5cad-138">Versions flottantes (génériques)</span><span class="sxs-lookup"><span data-stu-id="a5cad-138">Floating (wildcard) versions</span></span>

<span data-ttu-id="a5cad-139">Une version de dépendance flottante ou générique est spécifiée avec le caractère générique \*, comme dans 6.0.\*.</span><span class="sxs-lookup"><span data-stu-id="a5cad-139">A floating or wildcard dependency version is specified with the \* wildcard, as with 6.0.\*.</span></span> <span data-ttu-id="a5cad-140">Cette spécification signifie « utiliser la dernière version 6.0.x », et 4.\* signifie « utiliser la dernière version 4.x ».</span><span class="sxs-lookup"><span data-stu-id="a5cad-140">This version specification says "use the latest 6.0.x version"; 4.\* means "use the latest 4.x version."</span></span> <span data-ttu-id="a5cad-141">L’utilisation d’un caractère générique permet à un package de dépendance de continuer à évoluer, sans nécessiter la modification de l’application (ou du package) qui consomme.</span><span class="sxs-lookup"><span data-stu-id="a5cad-141">Using a wildcard allows a dependency package to continue evolving without requiring a change to the consuming application (or package).</span></span>

<span data-ttu-id="a5cad-142">Lorsque vous utilisez un caractère générique, NuGet résout la version la plus récente d’un package qui correspond au modèle de version. Par exemple, 6.0.\* obtient la version la plus récente d’un package commençant par 6.0 :</span><span class="sxs-lookup"><span data-stu-id="a5cad-142">When using a wildcard, NuGet resolves the highest version of a package that matches the version pattern, for example 6.0.\* gets the highest version of a package that starts with 6.0:</span></span>

![Choix de la version 6.0.1 lorsqu’une version flottante 6.0.* est demandée](media/projectJson-dependency-4.png)

> [!Note]
> <span data-ttu-id="a5cad-144">Pour plus d’informations sur le comportement des caractères génériques et les préversions, consultez [Gestion des versions de package](../reference/package-versioning.md#version-ranges-and-wildcards).</span><span class="sxs-lookup"><span data-stu-id="a5cad-144">For information on the behavior of wildcards and pre-release versions, see [Package versioning](../reference/package-versioning.md#version-ranges-and-wildcards).</span></span>


<a name="nearest-wins"></a>

#### <a name="nearest-wins"></a><span data-ttu-id="a5cad-145">Package le plus proche</span><span class="sxs-lookup"><span data-stu-id="a5cad-145">Nearest wins</span></span>

<span data-ttu-id="a5cad-146">Lorsque le graphique de package d’une application contient des versions différentes d’un même package, NuGet choisit le package qui est le plus proche de l’application dans le graphique, et ignore toutes les autres.</span><span class="sxs-lookup"><span data-stu-id="a5cad-146">When the package graph for an application contains different versions of the same package, NuGet chooses the package that's closest to the application in the graph and ignores all others.</span></span> <span data-ttu-id="a5cad-147">Ce comportement permet à une application de remplacer n’importe quelle version de package dans le graphique de dépendance.</span><span class="sxs-lookup"><span data-stu-id="a5cad-147">This behavior allows an application to override any particular package version in the dependency graph.</span></span>

<span data-ttu-id="a5cad-148">Dans l’exemple ci-dessous, l’application dépend directement du Package B ayant une restriction de version « supérieure ou égale à 2.0 ».</span><span class="sxs-lookup"><span data-stu-id="a5cad-148">In the example below, the application depends directly on Package B with a version constraint of >=2.0.</span></span> <span data-ttu-id="a5cad-149">L’application dépend également du Package A, qui, lui, dépend du Package B. Toutefois, sa restriction de version est « supérieure ou égale à 1.0 ».</span><span class="sxs-lookup"><span data-stu-id="a5cad-149">The application also depends on Package A which in turn also depends on Package B, but with a >=1.0 constraint.</span></span> <span data-ttu-id="a5cad-150">Étant donné que la dépendance du Package B 2.0 est plus proche de l’application dans le graphique, sa version est utilisée :</span><span class="sxs-lookup"><span data-stu-id="a5cad-150">Because the dependency on Package B 2.0 is nearer to the application in the graph, that version is used:</span></span>

![Application utilisant la règle du package le plus proche](media/projectJson-dependency-5.png)

>[!Warning]
> <span data-ttu-id="a5cad-152">La règle du package le plus proche peut entraîner le passage à une version antérieure du package, et rompre les autres dépendances du graphique.</span><span class="sxs-lookup"><span data-stu-id="a5cad-152">The Nearest Wins rule can result in a downgrade of the package version, thus potentially breaking other dependencies in the graph.</span></span> <span data-ttu-id="a5cad-153">Par conséquent, lorsque cette règle est appliquée, un avertissement s’affiche pour l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a5cad-153">Hence this rule is applied with a warning to alert the user.</span></span>

<span data-ttu-id="a5cad-154">Cette règle permet également une plus grande efficacité avec les graphiques de dépendance volumineux (tels que ceux qui contiennent des packages BCL), car une fois qu’une dépendance donnée est ignorée, NuGet ignore également toutes les dépendances de la même branche du graphique.</span><span class="sxs-lookup"><span data-stu-id="a5cad-154">This rule also results in greater efficiency with a large dependency graph (such as those with the BCL packages) because once a given dependency is ignored, NuGet also ignores all remaining dependencies on that branch of the graph.</span></span> <span data-ttu-id="a5cad-155">Dans le diagramme ci-dessous, par exemple, comme le Package C 2.0 est utilisé, NuGet ignore toutes les branches du graphique qui font référence à une version plus ancienne du Package C :</span><span class="sxs-lookup"><span data-stu-id="a5cad-155">In the diagram below, for example, because Package C 2.0 is used, NuGet ignores any branches in the graph that refer to an older version of Package C:</span></span>

![Lorsque NuGet ignore un package dans le graphique, il ignore l’intégralité de la branche du package](media/projectJson-dependency-6.png)

<a name="cousin-dependencies"></a>

#### <a name="cousin-dependencies"></a><span data-ttu-id="a5cad-157">Dépendances cousines</span><span class="sxs-lookup"><span data-stu-id="a5cad-157">Cousin dependencies</span></span>

<span data-ttu-id="a5cad-158">Lorsque des versions de package différentes sont référencées à une même distance de l’application, NuGet utilise la plus ancienne version qui répond à toutes les exigences de version (comme avec la règle de [la plus ancienne version applicable](#lowest-applicable-version) et la règle de [version flottante](#floating-versions)).</span><span class="sxs-lookup"><span data-stu-id="a5cad-158">When different package versions are referred to at the same distance in the graph from the application, NuGet uses the lowest version that satisfies all version requirements (as with the [lowest applicable version](#lowest-applicable-version) and [floating versions](#floating-versions) rules).</span></span> <span data-ttu-id="a5cad-159">Dans l’image ci-dessous, par exemple, la version 2.0 du Package B respecte l’autre restriction « supérieure ou égale à 1.0 », et est donc utilisée :</span><span class="sxs-lookup"><span data-stu-id="a5cad-159">In the image below, for example, version 2.0 of Package B satisfies the other >=1.0 constraint, and is thus used:</span></span>

![Résolution des dépendances cousines à l’aide de la plus ancienne version qui respecte toutes les restrictions](media/projectJson-dependency-7.png)

<span data-ttu-id="a5cad-161">Dans certains cas, il n’est pas possible de répondre à toutes les exigences de version.</span><span class="sxs-lookup"><span data-stu-id="a5cad-161">In some cases, it is not possible to meet all version requirements.</span></span> <span data-ttu-id="a5cad-162">Comme indiqué ci-dessous, si le Package A nécessite exactement le Package B 1.0, et si le Package C nécessite le Package B « version supérieure ou égale à 2.0 », NuGet ne peut pas résoudre les dépendances et génère une erreur.</span><span class="sxs-lookup"><span data-stu-id="a5cad-162">As shown below, if Package A requires exactly Package B 1.0 and Package C requires Package B >=2.0, then NuGet cannot resolve the dependencies and gives an error.</span></span>

![Dépendances ne pouvant être résolues en raison d’une spécification de version exacte](media/projectJson-dependency-8.png)

<span data-ttu-id="a5cad-164">Dans ce cas, le consommateur de niveau supérieur (l’application ou le package) doit ajouter sa propre dépendance directe au Package B pour que la règle de la [version la plus proche](#nearest-wins) soit appliquée.</span><span class="sxs-lookup"><span data-stu-id="a5cad-164">In these situations, the top-level consumer (the application or package) should add its own direct dependency on Package B so that the [Nearest Wins](#nearest-wins) rule applies.</span></span>

## <a name="dependency-resolution-with-packagesconfig"></a><span data-ttu-id="a5cad-165">Résolution des dépendances avec packages.config</span><span class="sxs-lookup"><span data-stu-id="a5cad-165">Dependency resolution with packages.config</span></span>

<span data-ttu-id="a5cad-166">Avec `packages.config`, les dépendances d’un projet sont écrites dans `packages.config` sous forme d’une liste plate.</span><span class="sxs-lookup"><span data-stu-id="a5cad-166">With `packages.config`, a project's dependencies are written to `packages.config` as a flat list.</span></span> <span data-ttu-id="a5cad-167">Toutes les dépendances de ces packages sont écrites dans une même liste.</span><span class="sxs-lookup"><span data-stu-id="a5cad-167">Any dependencies of those packages are also written in the same list.</span></span> <span data-ttu-id="a5cad-168">Lorsque les packages sont installés, NuGet peut également modifier le fichier `.csproj`, `app.config`, `web.config`, et d’autres fichiers.</span><span class="sxs-lookup"><span data-stu-id="a5cad-168">When packages are installed, NuGet might also modify the `.csproj` file, `app.config`, `web.config`, and other individual files.</span></span>

<span data-ttu-id="a5cad-169">Avec `packages.config`, NuGet tente de résoudre les conflits de dépendance lors de l’installation de chaque package.</span><span class="sxs-lookup"><span data-stu-id="a5cad-169">With `packages.config`, NuGet attempts to resolve dependency conflicts during the installation of each individual package.</span></span> <span data-ttu-id="a5cad-170">Autrement dit, si le Package A est en cours d’installation et dépend du Package B, et si ce dernier est déjà répertorié dans `packages.config` comme une dépendance d’un autre élément, NuGet compare les versions du Package B demandé et tente de trouver une version respectant toutes les restrictions de version.</span><span class="sxs-lookup"><span data-stu-id="a5cad-170">That is, if Package A is being installed and depends on Package B, and Package B is already listed in `packages.config` as a dependency of something else, NuGet compares the versions of Package B being requested and attempts to find a version that satisfies all version constraints.</span></span> <span data-ttu-id="a5cad-171">Plus précisément, NuGet sélectionne la version la plus ancienne *majeure.mineure* qui répond aux dépendances.</span><span class="sxs-lookup"><span data-stu-id="a5cad-171">Specifically, NuGet selects the lower *major.minor* version that satisfies dependencies.</span></span>

<span data-ttu-id="a5cad-172">Par défaut, NuGet 2.7 (et versions antérieures) résout la version de *correctif* la plus récente (à l’aide de la convention *majeure.mineure.correctif.build*).</span><span class="sxs-lookup"><span data-stu-id="a5cad-172">By default, NuGet 2.7 and earlier resolves the highest *patch* version (using the *major.minor.patch.build* convention).</span></span> <span data-ttu-id="a5cad-173">[NuGet 2.8 (et versions ultérieures)](../release-notes/nuget-2.8.md#patch-resolution-for-dependencies) modifie ce comportement et recherche la version de correctif la plus ancienne par défaut.</span><span class="sxs-lookup"><span data-stu-id="a5cad-173">[NuGet 2.8 and higher](../release-notes/nuget-2.8.md#patch-resolution-for-dependencies) changes this behavior to look for the lowest patch version by default.</span></span> <span data-ttu-id="a5cad-174">Vous pouvez contrôler ce paramètre via l’attribut `DependencyVersion` de `Nuget.Config`, et le commutateur `-DependencyVersion` sur la ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="a5cad-174">You can control this setting through the `DependencyVersion` attribute in `Nuget.Config` and the `-DependencyVersion` switch on the command line.</span></span>  

<span data-ttu-id="a5cad-175">Le processus `packages.config` de résolution des dépendances devient complexe pour les graphiques de dépendance plus volumineux.</span><span class="sxs-lookup"><span data-stu-id="a5cad-175">The `packages.config` process for resolving dependencies gets complicated for larger dependency graphs.</span></span> <span data-ttu-id="a5cad-176">Chaque nouvelle installation de package nécessite le parcours de l’ensemble du graphique, ce qui entraîne un risque de conflit de versions.</span><span class="sxs-lookup"><span data-stu-id="a5cad-176">Each new package installation requires a traversal of the whole graph and raises the chance for version conflicts.</span></span> <span data-ttu-id="a5cad-177">En cas de conflit, l’installation est arrêtée, ce qui laisse le projet dans un état indéterminé, avec des modifications potentielles du fichier projet.</span><span class="sxs-lookup"><span data-stu-id="a5cad-177">When a conflict occurs, installation is stopped, leaving the project in an indeterminate state, especially with potential modifications to the project file itself.</span></span> <span data-ttu-id="a5cad-178">Cela n’est pas un problème lorsque vous utilisez d’autres formats de référence de package.</span><span class="sxs-lookup"><span data-stu-id="a5cad-178">This is not an issue when using other package reference formats.</span></span>


## <a name="managing-dependency-assets"></a><span data-ttu-id="a5cad-179">Gestion des ressources de dépendance</span><span class="sxs-lookup"><span data-stu-id="a5cad-179">Managing dependency assets</span></span>

<span data-ttu-id="a5cad-180">Lorsque vous utilisez les formats `project.json` ou PackageReference, vous pouvez contrôler les ressources de dépendance qui sont acheminées dans le projet de niveau supérieur.</span><span class="sxs-lookup"><span data-stu-id="a5cad-180">When using the `project.json` or PackageReference formats, you can control which assets from dependencies flow into the top-level project.</span></span> <span data-ttu-id="a5cad-181">Pour plus d’informations, consultez [project.json](../Schema/project-json.md) et [Références de package dans les fichiers projet](Package-References-in-Project-Files.md#controlling-dependency-assets).</span><span class="sxs-lookup"><span data-stu-id="a5cad-181">For details, see [project.json](../Schema/project-json.md) and [Package references in project files](Package-References-in-Project-Files.md#controlling-dependency-assets).</span></span>

<span data-ttu-id="a5cad-182">Lorsque le projet de niveau supérieur est un package, vous pouvez contrôler ce flux en utilisant les attributs `include` et `exclude` avec les dépendances répertoriées dans le fichier `.nuspec`.</span><span class="sxs-lookup"><span data-stu-id="a5cad-182">When the top-level project is itself a package, you also have control over this flow by using the `include` and `exclude` attributes with dependencies listed in the `.nuspec` file.</span></span> <span data-ttu-id="a5cad-183">Consultez [Référence .nuspec - Dépendances](../Schema/nuspec.md#dependencies).</span><span class="sxs-lookup"><span data-stu-id="a5cad-183">See [.nuspec Reference - Dependencies](../Schema/nuspec.md#dependencies).</span></span>

## <a name="excluding-references"></a><span data-ttu-id="a5cad-184">Exclusion de références</span><span class="sxs-lookup"><span data-stu-id="a5cad-184">Excluding references</span></span>

<span data-ttu-id="a5cad-185">Il existe des scénarios dans lesquels les assemblys qui portent le même nom peuvent être référencés plusieurs fois dans un même projet, ce qui génère des erreurs au moment de la conception et de la génération.</span><span class="sxs-lookup"><span data-stu-id="a5cad-185">There are scenarios in which assemblies with the same name might be referenced more than once in a project, producing design-time and build-time errors.</span></span> <span data-ttu-id="a5cad-186">Imaginez un projet qui contienne une version personnalisée de `C.dll`, et qui référence le Package C contenant également `C.dll`.</span><span class="sxs-lookup"><span data-stu-id="a5cad-186">Consider a project that contains a custom version of `C.dll`, and references Package C that also contains `C.dll`.</span></span> <span data-ttu-id="a5cad-187">En même temps, le projet dépend également du Package B qui dépend du Package C et de `C.dll`.</span><span class="sxs-lookup"><span data-stu-id="a5cad-187">At the same time, the project also depends on Package B which also depends on Package C and `C.dll`.</span></span> <span data-ttu-id="a5cad-188">Par conséquent, NuGet ne peut pas déterminer quel `C.dll` utiliser. Toutefois, vous ne pouvez pas supprimer la dépendance du projet au Package C, car le Package B en dépend également.</span><span class="sxs-lookup"><span data-stu-id="a5cad-188">As a result, NuGet can't determine which `C.dll` to use, but you can't just remove the project's dependency on Package C because Package B also depends on it.</span></span>

<span data-ttu-id="a5cad-189">Pour résoudre ce problème, vous devez référencer directement le `C.dll` que vous souhaitez (ou utiliser un autre package qui référence celui qui convient), puis ajouter une dépendance au Package C qui exclut toutes ses ressources.</span><span class="sxs-lookup"><span data-stu-id="a5cad-189">To resolve this, you must directly reference the `C.dll` you want (or use another package that references the right one), and then add a dependency on Package C that excludes all its assets.</span></span> <span data-ttu-id="a5cad-190">Pour cela, effectuez les étapes suivantes, selon le format de référence de package que vous utilisez :</span><span class="sxs-lookup"><span data-stu-id="a5cad-190">This is done as follows depending on the package reference format in use:</span></span>

- <span data-ttu-id="a5cad-191">[PackageReference](../consume-packages/package-references-in-project-files.md) : ajoutez `Exclude="All"` dans la dépendance :</span><span class="sxs-lookup"><span data-stu-id="a5cad-191">[PackageReference](../consume-packages/package-references-in-project-files.md): add `Exclude="All"` in the dependency:</span></span>

    ```xml
    <PackageReference Include="PackageC" Version="1.0.0" Exclude="All" />
    ```

- <span data-ttu-id="a5cad-192">`packages.config` : supprimez la référence au Package C dans le fichier `.csproj` pour qu’il référence uniquement la version du `C.dll` souhaitée.</span><span class="sxs-lookup"><span data-stu-id="a5cad-192">`packages.config`: remove the reference to PackageC from the `.csproj` file so that it references only the version of `C.dll` that you want.</span></span>
    
- <span data-ttu-id="a5cad-193">`project.json` : ajoutez `"exclude" : "all"` dans la dépendance au Package C :</span><span class="sxs-lookup"><span data-stu-id="a5cad-193">`project.json`: add `"exclude" : "all"` in the dependency for PackageC:</span></span>

    ```json
    {
        "dependencies": {
            "PackageC": {
            "version": "1.0.0",
            "exclude": "all"
            }
        }
    }
    ```

## <a name="dependency-updates-during-package-install"></a><span data-ttu-id="a5cad-194">Mises à jour des dépendances pendant l’installation du package</span><span class="sxs-lookup"><span data-stu-id="a5cad-194">Dependency updates during package install</span></span> 

<span data-ttu-id="a5cad-195">Avec NuGet 2.4.x et versions antérieures, lorsqu’un package est installé et que sa dépendance existe déjà dans le projet, la dépendance est mise à jour vers la dernière version qui respecte les restrictions de version, même si la version existante respecte également ces restrictions.</span><span class="sxs-lookup"><span data-stu-id="a5cad-195">With NuGet 2.4.x and earlier, when a package is installed whose dependency already exists in the project, the dependency is updated to the latest version that satisfies the version constraints, even if the existing version also satisfies those constraints.</span></span> 

<span data-ttu-id="a5cad-196">Par exemple, imaginons le Package A qui dépend du Package B et qui spécifie 1.0 comme numéro de version.</span><span class="sxs-lookup"><span data-stu-id="a5cad-196">For example, consider package A that depends on package B and specifies 1.0 for the version number.</span></span> <span data-ttu-id="a5cad-197">Le référentiel source contient les versions 1.0, 1.1 et 1.2 du Package B. Si le Package A est installé dans un projet qui contient déjà le Package B version 1.0, celui-ci est mis à jour vers la version 1.2.</span><span class="sxs-lookup"><span data-stu-id="a5cad-197">The source repository contains both versions 1.0, 1.1, and 1.2 of package B. If A is installed in a project that already contains B version 1.0, then B is updated to version 1.2.</span></span> 

<span data-ttu-id="a5cad-198">Avec NuGet 2.5 et versions ultérieures, si une condition de version de dépendance est déjà satisfaite, la dépendance n’est pas mise à jour lors des autres installations de package.</span><span class="sxs-lookup"><span data-stu-id="a5cad-198">With NuGet 2.5 and later, if a dependency version is already satisfied, the dependency isn't updated during other package installations.</span></span> 

<span data-ttu-id="a5cad-199">Dans l’exemple ci-dessus, l’installation du Package A dans un projet avec NuGet 2.5 ou version ultérieure conserve le Package B 1.0 dans le projet, puisqu’il respecte déjà la restriction de version.</span><span class="sxs-lookup"><span data-stu-id="a5cad-199">In the same example above, installing package A into a project with NuGet 2.5 and later leaves package B 1.0 in the project, as it already satisfies the version constraint.</span></span> <span data-ttu-id="a5cad-200">Toutefois, si le Package A avait demandé la version 1.1 ou ultérieure du Package B, le Package B 1.2 serait installé.</span><span class="sxs-lookup"><span data-stu-id="a5cad-200">However, if package A had requests version 1.1 or higher of B, then B 1.2 would be installed.</span></span> 

## <a name="resolving-incompatible-package-errors"></a><span data-ttu-id="a5cad-201">Résolution des erreurs de package incompatible</span><span class="sxs-lookup"><span data-stu-id="a5cad-201">Resolving incompatible package errors</span></span>

<span data-ttu-id="a5cad-202">Pendant une opération de restauration de package, vous pouvez rencontrer une erreur vous informant qu’un ou plusieurs packages ne sont pas compatibles ou qu’un package n’est pas compatible avec la version cible du .NET Framework du projet.</span><span class="sxs-lookup"><span data-stu-id="a5cad-202">During a package restore operation, you may see the error "One or more packages are not compatible..." or that a package "is not compatible" with the project's target framework.</span></span>

<span data-ttu-id="a5cad-203">Cette erreur se produit lorsqu’un ou plusieurs des packages référencés dans votre projet n’indiquent pas qu’ils prennent en charge la version cible de .NET Framework du projet. Autrement dit, aucune DLL correspondant à une version cible de .NET Framework ne se trouve dans le dossier `lib` du package</span><span class="sxs-lookup"><span data-stu-id="a5cad-203">This error occurs when one or more of the packages referenced in your project do not indicate that they support the project's target framework; that is, the package does not contain a suitable DLL in its `lib` folder for a target framework that is compatible with the project.</span></span> <span data-ttu-id="a5cad-204">(consultez [Versions cibles de .NET Framework](../Schema/Target-Frameworks.md) pour obtenir la liste des versions cibles).</span><span class="sxs-lookup"><span data-stu-id="a5cad-204">(See [Target frameworks](../Schema/Target-Frameworks.md) for a list.)</span></span> 

<span data-ttu-id="a5cad-205">Par exemple, si un projet cible `netstandard1.6` et que vous essayez d’installer un package où des DLL ne sont présentes que dans les dossiers `lib\net20` et `\lib\net45`, vous verrez des messages tels que le suivant pour le package et, éventuellement, ses éléments dépendants :</span><span class="sxs-lookup"><span data-stu-id="a5cad-205">For example, if a project targets `netstandard1.6` and you attempt to install a package that contains DLLs in only the `lib\net20` and `\lib\net45` folders, then you'll see messages like the following for the package and possibly its dependents:</span></span>

```output
Restoring packages for myproject.csproj...
Package ContosoUtilities 2.1.2.3 is not compatible with netstandard1.6 (.NETStandard,Version=v1.6). Package ContosoUtilities 2.1.2.3 supports:
  - net20 (.NETFramework,Version=v2.0)
  - net45 (.NETFramework,Version=v4.5)
Package ContosoCore 0.86.0 is not compatible with netstandard1.6 (.NETStandard,Version=v1.6). Package ContosoCore 0.86.0 supports:
  - 11 (11,Version=v0.0)
  - net20 (.NETFramework,Version=v2.0)
  - sl3 (Silverlight,Version=v3.0)
  - sl4 (Silverlight,Version=v4.0)
One or more packages are incompatible with .NETStandard,Version=v1.6.
Package restore failed. Rolling back package changes for 'MyProject'.
```

<span data-ttu-id="a5cad-206">Pour résoudre les incompatibilités, effectuez l’une des opérations suivantes :</span><span class="sxs-lookup"><span data-stu-id="a5cad-206">To resolve incompatibilities, do one of the following:</span></span>

- <span data-ttu-id="a5cad-207">Reciblez votre projet vers un framework pris en charge par les packages que vous souhaitez utiliser.</span><span class="sxs-lookup"><span data-stu-id="a5cad-207">Retarget your project to a framework that is supported by the packages you want to use.</span></span>
- <span data-ttu-id="a5cad-208">Contactez l’auteur des packages et ajoutez ensemble la prise en charge du framework de votre choix.</span><span class="sxs-lookup"><span data-stu-id="a5cad-208">Contact the author of the packages and work with them to add support for your chosen framework.</span></span> <span data-ttu-id="a5cad-209">Chaque page qui répertorie des packages sur [nuget.org](https://www.nuget.org/) comprend le lien **Contact Owners** qui permet de contacter les propriétaires des packages.</span><span class="sxs-lookup"><span data-stu-id="a5cad-209">Each package listing page on [nuget.org](https://www.nuget.org/) has a **Contact Owners** link for this purpose.</span></span>
- <span data-ttu-id="a5cad-210">**Non recommandé** : lorsque vous collaborez avec l’auteur du package, vous pouvez, comme solution temporaire, faire en sorte que les projets ciblant `netcore`, `netstandard` et `netcoreapp` référencent d’autres frameworks comme étant compatibles. Vous permettez ainsi l’utilisation des packages qui ciblent ces autres frameworks.</span><span class="sxs-lookup"><span data-stu-id="a5cad-210">**Not recommended**: as a temporary solution while you work with the package author, projects targeting `netcore`, `netstandard`, and `netcoreapp` can denote other frameworks as being compatible, thereby allowing packages targeting those other frameworks to be used.</span></span> <span data-ttu-id="a5cad-211">Consultez [Importations project.json](../Schema/project-json.md#imports) et [Restauration de cibles MSBuild avec PackageTargetFallback](../Schema/msbuild-targets.md#packagetargetfallback).</span><span class="sxs-lookup"><span data-stu-id="a5cad-211">See [project.json imports](../Schema/project-json.md#imports) and [MSBuild restore target PackageTargetFallback](../Schema/msbuild-targets.md#packagetargetfallback).</span></span> <span data-ttu-id="a5cad-212">Cela peut provoquer des comportements inattendus. Par conséquent, il est préférable de résoudre les incompatibilités de package en travaillant à une mise à jour du package avec son auteur.</span><span class="sxs-lookup"><span data-stu-id="a5cad-212">This can cause unexpected behaviors, so again, it's best to resolve package incompatibilities by working with the package author on an update.</span></span>
